# フェーズアップ導線機能

## 概要

詳細ページの体験を"終わらせない"ための機能。ロック中セクションの直下に「なぜ見れないか」「どうすれば解除されるのか」を行動条件で示します。

レコメンド機能と対になる機能として、ユーザーを次のステップへ導きます。

## 実装内容

### 1. フェーズアップの行動条件定義

**ファイル**: `lib/domain/phase-upgrade.ts`

**機能**:
- 各フェーズレベルから次のレベルへの行動条件を定義
- 数字・実績ではなく、具体的な行動を提示

**行動条件の定義**:

#### Lv1 → Lv2（並び順: 軽い → 重い）
1. 他の投稿に共感する（今すぐできること）
2. 自分の経験を投稿する（リンクあり）
3. 継続的に参加する

#### Lv2 → Lv3（並び順: 軽い → 重い）
1. 他のユーザーと交流する（今すぐできること）
2. 複数の投稿を作成する（リンクあり）
3. 自分の回復プロセスを振り返る

**ルール**:
- 最大3つまで
- 並び順は「軽い → 重い」（今すぐできることが先頭）
- リンクは1つだけ（投稿作成のみ）

### 2. コンポーネント: `PhaseUpgradeGuide`

**ファイル**: `components/PhaseUpgradeGuide.tsx`

**表示内容**:
- **なぜ見れないか**: 固定文言で表示（`PHASE_LOCK_REASON`）
  - Lv1: "このセクションは、回復の実体験を積んだ人のために用意されています。"
  - Lv2: "このセクションは、他者を導く立場になった人向けの内容です。"
- **どうすれば解除されるのか**: 次のフェーズレベルになるための行動条件をリスト表示（最大3つ）

**UI特徴**:
- 青系の背景色で、情報提供のトーンを保つ
- 行動条件ごとにチェックマークと説明を表示
- リンクがある場合は、直接アクションできるようにリンクを表示

### 3. 詳細ページへの統合

**ファイル**: `app/posts/[id]/page.tsx`

**配置**:
- ロックメッセージ（`PHASE_LOCK_MESSAGE`）の直下に配置
- `post.is_summary_only`が`true`の場合のみ表示

## 設計思想

### 数字・実績ではなく行動条件

- **理由**: 数字は競争を生む。Re:Start Atlasは「回復の場」として、行動を促す
- **実装**: 具体的な行動（投稿作成、共感、交流など）を提示

### 固定文言の重要性

- **なぜ見れないか**: 動的に生成せず、固定文言を使用
- **理由**: 
  - 比較されない
  - スクショされても意味が変わらない
  - SNSで引用されても思想が歪まない

### 行動条件の設計原則

- **最大3つまで**: 人は多いと動けない
- **並び順は「軽い → 重い」**: 「今すぐできること」が必ず先頭に来る
- **リンクは1つだけ**: UIが「タスク管理」になるのを防ぐため

### レコメンドと対になる機能

- **レコメンド**: 「次を見る」導線（横への導線）
- **フェーズアップ導線**: 「進む」導線（上への導線）

両方の導線を提供することで、ユーザーの体験を継続させます。

## 使用例

```typescript
// 詳細ページでの使用
<PhaseUpgradeGuide
  currentPhaseLevel={userPhaseLevel} // nullの場合はLv1扱い
  postPhaseLevel={post.phase_at_post}
  isLocked={post.is_summary_only}
/>
```

## 今後の拡張案

### v2: 行動の進捗表示
- ユーザーの行動履歴を追跡
- 「あと1つ投稿を作成すればLv2になります」のような進捗表示

### v3: 自動フェーズアップ
- 行動条件を満たした場合、自動的にフェーズレベルを上げる
- トリガーやRPC関数で実装

### v4: パーソナライズ
- ユーザーの行動パターンに応じた、より具体的な行動条件を提示

## 注意事項

- **匿名ユーザー**: `currentPhaseLevel`が`null`の場合はLv1扱い
- **最高レベル**: Lv3ユーザーにはアップグレード条件を表示しない
- **ロックされていない場合**: `isLocked`が`false`の場合は何も表示しない
