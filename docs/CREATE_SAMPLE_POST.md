# サンプル投稿作成ガイド

詳細ページの確認用にサンプル投稿を作成する手順です。

## 前提条件

1. **マイグレーション実行**: `20250201000000_add_post_detail_rpc.sql` をSupabaseで実行してください
2. **ログイン**: アプリにログインしていること

## サンプル投稿作成手順

### 1. ダッシュボードから投稿作成ページへ

1. `/dashboard` にアクセス
2. 「新規投稿」ボタンをクリック
3. `/posts/create` に遷移

### 2. フォーム入力例

#### 基本情報
- **タイトル**: `借金300万円からの回復`
- **概要**: `25歳の時にクレジットカードの借金を抱え、実家に戻って返済を開始しました。家族のサポートと節約生活で3年かけて完済しました。`
- **問題カテゴリ**: `借金`
- **投稿時のフェーズ**: `Lv2（回復中）` または `Lv3（回復完了）`
- **詰み始めた時期**: `2021-01-01`
- **回復した時期**: `2024-01-01`（Lv3の場合）
- **現在の状況**: `完済しました。現在は貯金に回しています。`

#### 検索特化フィールド
- **当時の年齢**: `25`
- **借金額（万円単位）**: `300`（借金カテゴリの場合）
- **無職期間（月単位）**: （失業カテゴリの場合）
- **回復期間（月単位）**: `36`（回復した時期がある場合）

#### ステップ（行動ログ）
最低1つ以上追加：

1. **ステップ1**（成功）
   - 内容: `実家に戻って生活費を削減`
   - 失敗: チェックなし

2. **ステップ2**（成功）
   - 内容: `アルバイトを2つ掛け持ち`
   - 失敗: チェックなし

3. **ステップ3**（失敗）
   - 内容: `クレジットカードを解約`
   - 失敗: チェックあり
   - 失敗理由: `すぐに再発行してしまった。自制心が足りなかった。`

4. **ステップ4**（成功）
   - 内容: `家計簿アプリで支出を可視化`
   - 失敗: チェックなし

5. **ステップ5**（成功）
   - 内容: `毎月の返済額を固定して計画を立てる`
   - 失敗: チェックなし

#### 地域・タグ
- **地域**: 任意（例: 東京都）
- **タグ**: 任意（例: `25歳`, `借金300万`, `実家暮らし`, `完済`）

### 3. 投稿作成後の確認

1. **投稿作成成功**: 自動的に `/posts/[id]` にリダイレクトされます
2. **詳細ページの確認**:
   - [A] ヘッダー: フェーズバッジ、カテゴリ、タイトル
   - [B] 当時の状況: 数字カード（年齢、借金額、回復期間）
   - [C] 詰んだ理由: 引用ブロック風
   - [D] 行動ログ: 成功/失敗バッジ、失敗理由
   - [E] 転機ポイント: 強調ブロック
   - [F] 今の状態: 淡い背景
   - [G] 過去の自分へ: 魂の一文

### 4. フェーズ制御の確認（オプション）

Lv1ユーザーでLv3投稿を見る場合:
- A〜Bまでは表示
- C以降はぼかし表示 + 「🔒 今はここまで」メッセージ

確認方法:
1. Lv1ユーザーでログイン
2. Lv3投稿の詳細ページにアクセス
3. C以降がぼかされていることを確認

## 複数のサンプル投稿を作成する場合

以下のパターンで複数作成すると、一覧ページでの表示も確認できます：

1. **借金カテゴリ、Lv2（回復中）**
2. **失業カテゴリ、Lv3（回復完了）**
3. **借金カテゴリ、Lv1（問題発生中）** - 失敗ステップを含む

## トラブルシューティング

### エラー: "投稿が見つかりませんでした"
- マイグレーション `20250201000000_add_post_detail_rpc.sql` が実行されているか確認
- RPC関数 `get_recovery_post_detail` が存在するか確認

### エラー: "created_at is ambiguous"
- `create_recovery_post` RPC関数の問題です
- 詳細ページとは別の問題なので、投稿作成自体は可能です
- 必要に応じて `fix_create_recovery_post_complete.sql` を実行

### ステップが表示されない
- ステップが1つ以上作成されているか確認
- RPC関数の `steps` JSONB配列が正しく返されているか確認
